<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sign-Out Admin</title>
  <style>
    body{font-family:sans-serif;margin:0;background:#0b1220;color:#eef;}
    header{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;background:#111a2b;position:sticky;top:0;}
    input,select{padding:6px 8px;border-radius:6px;border:1px solid #334;background:#0f1626;color:#eef;}
    table{width:100%;border-collapse:collapse;}
    th,td{padding:8px 10px;border-bottom:1px solid #1f2940;text-align:left;}
    th{background:#0f1626;position:sticky;top:48px;}
    .wrap{max-width:1100px;margin:0 auto;}
  </style>
</head>
<body>
  <header>
    <div>Sign-Out Admin</div>
    <div>
      <input id="q" placeholder="Filterâ€¦">
      <select id="auto">
        <option value="5000">Auto: 5s</option>
        <option value="10000">10s</option>
        <option value="30000">30s</option>
        <option value="0">Off</option>
      </select>
    </div>
  </header>

  <div class="wrap">
    <table>
      <thead>
        <tr>
          <th>Time</th>
          <th>Name</th>
          <th>ID</th>
          <th>Source</th>
          <th>Device</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
  </div>

  <script src="./config.js"></script>
  <script>
    const { API_BASE } = window.APP_CONFIG;
    const rowsEl = document.getElementById('rows');
    const qEl    = document.getElementById('q');
    const autoEl = document.getElementById('auto');
    let timer = null;

    function start(){
      load();
      setAuto();
      autoEl.addEventListener('change', setAuto);
      qEl.addEventListener('input', render);
    }
    function setAuto(){
      if (timer) clearInterval(timer);
      const ms = Number(autoEl.value);
      if (ms > 0) timer = setInterval(load, ms);
    }
    async function load(){
      try{
        const res = await fetch(`${API_BASE}?route=recent`);
        const data = await res.json();
        window.__data = Array.isArray(data) ? data.reverse() : [];
        render();
      }catch(e){ console.error(e); }
    }
    function render(){
      const q = qEl.value.trim().toLowerCase();
      const arr = (window.__data || []).filter(r => !q || JSON.stringify(r).toLowerCase().includes(q));
      rowsEl.innerHTML = arr.map(r => {
        const t = r.Timestamp ? new Date(r.Timestamp).toLocaleString() : '';
        const name = [r.FirstName, r.LastName].filter(Boolean).join(' ');
        return `<tr>
          <td>${t}</td>
          <td>${name}</td>
          <td>${r.StudentID || ''}</td>
          <td>${r.Source || ''}</td>
          <td>${r.DeviceID || ''}</td>
        </tr>`;
      }).join('');
    }
    start();
  </script>
</body>
</html>
